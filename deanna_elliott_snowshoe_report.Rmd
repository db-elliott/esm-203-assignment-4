---
title: "Assignment 5"
author: "Deanna Elliott"
date: "11/6/2021"
output: html_document
---

```{r setup, include=FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

options(digits = 4)

library(tidyverse)
library(janitor)
library(here)
library(kableExtra)
library(lubridate)
library(effsize)
library(broom)
```

## **Overview**

A 4 - 5 sentence "mini-introduction" to what this study is exploring, including basic background information about the subject, site and study (with citations as needed), and a brief overview of what is included in the exploratory report. You should probably do this last so you know what’s contained in the report.


## **Data & Analysis**

A 3 - 4 sentence section in which you briefly describe the data, including citation & credit as needed, and provide an overview of the main analysis, statistical methods and tools used.


## **Juvenile Hare Initial Investigation**

### Annual Juvenile Hare Trap Counts

```{r, include = FALSE}

juv_hares <- read_csv(here("data", "bonanza_hares.csv")) %>% 
  filter(age == "j") %>% 
  mutate(date = mdy(date)) %>% 
  mutate(year = year(date)) 

ann_traps <- juv_hares %>% 
  group_by(year) %>% 
  summarize(sample = n())

ann_traps %>% 
  summarize(min = min(sample), max = max(sample), 
            median = median(sample), mean = mean(sample))

days_spent <- juv_hares %>% 
  group_by(session_id) %>% 
  summarize(sample = n())
```

```{r}

ggplot(data = ann_traps,
       aes(x = year, y = sample)) +
  geom_col(fill = "cadetblue2", color = "black") +
  labs(x = "Year", y = "Sample Size")

```

**Figure 1. Juvenile snowshoe hare trap count by year.** Over the course of 15 years (1998-2012), the Bonanza Creek Long Term Ecological Research Network collected trap observations of snowshoe hares. The minimum trap count of juvenile hares per year was `r min(ann_traps$sample)`, occurring in 2010, while the maximum trap count was `r max(ann_traps$sample)`, occurring in 1999. The mean trap count value over the course of the study was 31, while the median was 18. After 1999, there was a sharp drop off in juvenile count by almost half, and the numbers never recovered across the life of available data. There were spikes in 2005 and 2008, but even those did not reach the value of 2000, let alone 1999. Based on this data, it seems the count of trapped juvenile hares is fairly low annually in comparison.

.

##### **Suggestions**
These are absolute counts, but these counts are also impacted by effort. The number of days spent observing each year swings between `r min(days_spent$sample)` and `r max(days_spent$sample)`. Moving forward, I would suggest that the study regulate the number of observers and the number of days spent observing per year in order to standardize the juvenile hare population count in future analyses.


### Visualize Juvenile Hare Weights

```{r}

site_hares <-juv_hares %>% 
  mutate(grid_full = case_when(
    grid == "bonrip" ~ "Riparian",
    grid == "bonmat" ~ "Mature",
    grid == "bonbs" ~ "Black Spruce")) %>% 
  mutate(sex = case_when(
    sex == "f" ~ "Female",
    sex == "m" ~ "Male",
    is.na(sex) == TRUE ~ "Unknown"))

ggplot(data = site_hares,
       aes(x = sex, y = weight, color= sex)) +
  scale_color_manual(values = c("violetred", "royalblue1", "seagreen4")) +
  geom_jitter(na.rm = FALSE) +
  theme(legend.position = "none") +
  facet_wrap(~ grid_full) +
  labs(x = "Sex", y = "Weight (g)")
```

**Figure 2. Juvenile snowshoe hare weights by sex and site.** Three sites in the Bonanza Creek LTER were observed for juvenile snowshoe hares. The riparian site yielded the highest number of both male and female hares, followed by the mature site and the black spruce site. Weights of hares at each site follow a similar distribution pattern regardless of sex. The riparian site had a small number of weight observations above the maximums of mature and black spruce. The few observed animals of unknown sex fall into the general distribution, excepting three at the riparian site that fall under the otherwise lightest weights.


## **Juvenile Weight Comparison**
### Male & Female Hares

```{r}

site_hares %>% 
  group_by(sex) %>%
  filter(sex %in% c("Male", "Female")) %>% 
  summarize(mean = mean(weight, na.rm = TRUE), stdev = sd(weight, na.rm = TRUE), sample = n()) %>% 
  kbl(col.names = c("Sex", "Mean Weight (g)", "Standard Devation (g)", "Sample Size"), caption = "<b> Table 1. Summary statistics for snowshoe hare weight.</b> Mean and standard deviation in g, with sample sizes of male and female juvenile snowshoe hares observed at the Bonanza Creek LTER.") %>% 
  kable_classic()
```
 
```{r, exploration of assumptions, include = FALSE}

weight_male <- site_hares %>% 
  filter(sex == "Male") %>% 
  drop_na(weight) %>% 
  pull(weight)

weight_female <- site_hares %>% 
  filter(sex == "Female") %>% 
  drop_na(weight) %>% 
  pull(weight)


hist(weight_female) #pretty normal
hist(weight_male) #normal-ish

ggplot(data = site_hares, aes(sample = weight)) +
  geom_qq() +
  facet_wrap(~ sex)

# female data looks pretty normal, male data looks normal enough
# I can use a t-test
```

```{r}

t_test <- t.test(weight_female, weight_male)

cd <- cohen.d(weight_female, weight_male)
```

.

The mean weight of male snowshoe hares at Bonanza LTER is 90.5 g more than the mean female weight; this is a 10.05% difference. If these samples were taken from populations with the same mean, there is a `r round(t_test$p.value*100, 2)`% chance of finding sample means *at least* as different as these. The means of male and female weights did not differ significantly (t-test; t = `r (t_test$statistic)`, p = `r round(t_test$p.value, 4)`). Additionally, the effect size of the difference is small (Cohen's d; d = `r round(cd$estimate, 2)`).


## **Relationship: Juvenile Weight & Hind Foot Length**

 Explore the relationship between juvenile snowshoe hare hind foot length (variable `hindft`, recorded in millimeters), and weight. Include all juvenile hares in the study. Create a final visualization of juvenile hare hind foot length versus weight. Include a figure caption.

```{r}

ggplot(data = juv_hares, 
       aes(y = weight, x = hindft)) +
  geom_jitter(aes(color = age)) +
  geom_smooth(method = "lm") +
  scale_color_manual(values = "darkblue") + 
  theme(legend.position = "none",
        panel.background = element_rect(fill = "cadetblue2", colour = "cadetblue",
                                size = 2, linetype = "solid"),
        panel.grid.major = element_line(size = 0.5, linetype = 'solid',
                                colour = "white"), 
        panel.grid.minor = element_line(size = 0.25, linetype = 'solid',
                                colour = "white")) +
  labs(x = "Hindfoot Length (mm)", y = "Weight (g)")
```


**Figure 3. Juvenile snowshoe hare hind foot length vs weight.** Measurements of juvenile hares in the Bonanza Creek LTER seem to show a weakly positive correlation between hind foot length (in mm) and weight (in g). Generally, as the length of the hind foot increases, so does the animal's weight.

```{r}

hares_lm <- lm(weight ~ hindft, data = juv_hares) #create linear model
summary(hares_lm)
# Coef = -279.34 (intercept), 9.52 (hindft = slope)

hares_lm_tidy <- tidy(hares_lm) #get lm stats

hares_lm_glance <- glance(hares_lm) #get model fit & stat significance
# r-sq = 0.2988, adj r-sq = 0.2959
# p-value = 8.458e-21, reject null

cor.test(hindft, weight)
```

The linear regression model of juvenile hare hind foot length versus weight shows a slope of `r round(hares_lm$coefficients [2], 2)` g/mm, meaning that, on average, we would expect to see a `r round(hares_lm$coefficients [2], 2)` g increase in weight for every 1 mm increase in hind foot length. The adjusted R-squared value shows that `r round(hares_lm_glance$adj.r.squared, 3)*100`% of the variance in weight is explained by hind foot length.

In 2 - 3 sentences below your figure, describe the outcome of your linear regression exploration (e.g. slope interpretation, R2 value, and Pearson's r correlation) and touch briefly on which assumption(s) of linear regression may be a concern, and additional thoughts you have about how well (or not well…) the linear model describes the relationship. What worries you? 


## **Summary**
 Include a very short summary describing your main findings from your juvenile hares exploration (bullet points are fine)


## **Citations**

 Include citations (professionally formatted), including the data citation and any other resources that were references in your mini report. 
